## 第一章 分布式系统介绍
分布式系统的定义：组件分布在网络计算机上，组件间仅仅通过消息传递来通信并协调行动。

分布式系统的意义：

 - 升级单机处理能力的性价比越来越低
 - 单机处理能力存在瓶颈
 - 处于稳定性和可用性的考虑

摩尔定律：当价格不变时，每隔18个月，集成电路上可容纳的晶体管数目会增加一倍，性能也将提升一倍。

### 线程与进程的执行模式

冯诺依曼结构：输入设备、输入设备、运算器、控制器、存储器。

基于共享容器协同的多线程模式：经典如生产者消费者问题，对于存储数据的容器或对象，有线程安全和不安全之分，对于不安全的容器或对象，一般可以通过加锁或者通过Copy On Write的方式控制并发。

通过事件协同的多线程模式：避免死锁

多进程模式：

- 线程是属于进程的，一个进程内的多个线程共享了进程的内存空间；而多个进程间的内存空间是独立的，因此多个进程间通过内存共享、交换数据的方式与多个线程间就有所不同
- 此外，进程间通信、协调，以及通过一些事件通知或者等待一些互斥锁的释放方面也不一样
- 多进程相对于单进程多线程来说，资源控制会更容易实现；多进程中单个进程出现问题，不会造成整体的不可用
- 多进程之间可以共享数据，但其代价较大，会涉及序列化和反序列化的开销

### 网络通信基础知识

OSI七层模型与TCP/IP模型：

Socket套接字进行网络通信开发时，用到的三种方式：BIO、NIO和AIO

BIO：Blocking IO，采用阻塞的方式实现，一个线程处理一个Socket，发生建立连接、读数据、写数据的操作时，都可能会阻塞

NIO：Nonblocking IO，基于时间驱动思想，采用Reactor模式，可以在一个线程中处理多个Socket套接字

AIO：AsynchronousIO，异步IO，采用Proactor模式，与NIO的差别是，AIO在进行读写操作时，只需要调用响应的read/write方法，并且需要传入CompletionHandler，在动作完成后会调用。

### 如何把应用从单机扩展到分布式
输入设备的变化

输出设备的变化

控制器的变化

方式1和2，透明代理：对发起方和处理方都是透明的
- 使用硬件负载均衡
- 使用LVS（或其他软件负载均衡系统）
缺点：
- 会增加网络的开销，一方面指流量，另一方面指延迟
- 这个透明代理处于请求的必经之路，如果代理出现问题，所有请求都会受到影响。我们需要考虑代理服务器的热备份

方式3，采用名称服务器直连的方式：

请求发起方和处理方直接没有代理服务器，而是直接连接。外部多了一个“名称服务”的角色，作用有：
- 收集提供请求处理的服务器的地址信息
- 提供这些地址信息给请求发起方

名称服务只是起到一个地址交换的作用，在发起请求的机器上，需要根据从名称服务得到的地址进行负载均衡的工作。

优点如下：
- 名称服务器出现问题，有办法可以保证处理正常
- 发起方和处理方直连，减少中间路径和带宽小号

方式4，采用规则服务器控制路由的请求直连调用

与名称服务器不同的是，规则服务器并不和请求处理的机器交互，只负责把规则提供给请求发起的机器。

方式5，Master+Worker的方式

存在一个Master节点来管理任务，由Master把任务分配给不同的Worker进行处理。

运算器的变化
- 通过DNS服务器进行调度和控制
- 增加负载均衡设备，DNS返回的永远是负载均衡地址

